---
title: VPS自建节点一文通
published: 2025-03-29T14:48:54+08:00
description: "本文包括关于自建节点所需要了解的一切"
toc: false
tags: [vps, 自建节点,科学上网]
weight: 3
---


## 提出问题 - 这篇文章能解决什么问题

0. 为什么要自建节点，为了更高的稳定性？更快的速度？更强的隐私性？更多可定制化内容？或者是在这个AI时代，为了一个干净的IP？亦或者是跨境电商的需求？

如果你的回答是为了更高的稳定性，或者是更快的速度，那么我将不推荐自建节点，只需要买一个贵一点的机场就可以解决，如果是为了解决别的问题，那么请继续

1. 如何购买VPS - VPS选购引，需结合第三部分的什么是CN2-GIA一起，为了文章逻辑清晰而分两部分

2. 如何搭建节点 - 3x-ui的使用

3. 为什么自己搭建的节点速度那么慢和不稳定 - 什么是CN2 GIA ， 什么是BBR加速 ， 什么是中转专线　，　什么是CDN加速

4. 为什么自己的节点总是被封 - 域名有什么用

5. 为什么自己的节点建账号总是被风控，为什么ChatGPT总是降智，为什么claude账号总是被封 - 什么是住宅IP，如何选购住宅IP ，怎么检测IP质量


**环境**

服务器：ubantu
PC代理软件：v2rayN
手机代理软件：QuanX


## 1. 如何购买VPS

### 1.1 什么是VPS

本质上是一台服务器安装了虚拟化软件后，将资源划分成多个独立的虚拟服务器，每个虚拟服务器单独卖，能多卖好多次，你可以通过网上任意提供商购买，或选择知名厂商购买。

### 1.2 大牌推荐

- **搬瓦工（BandwagonHost）** - 价格适中、线路优质（约50元/月）
- **DMIT** - 价格适中、线路优质（约50元/月）
- **Vultr** - 价格适中、线路优质（约50元/月）
- **RackNerd** - 性价比高（约10元/月）

点进去,选购,付钱,可以用支付宝

图便宜可以选择美国西部的服务器，但是延迟会比较高，图低延迟可以选择日本的服务器，就是比较贵

## 2. 如何搭建节点

目前较新的主流方案是使用 **3X-UI** 而非旧版的X-ui。

### 2.1 连接购买的VPS

完成购买后，你会在邮箱收到服务器的IP地址、SSH连接用户名和密码。推荐使用 **FinalShell** 工具连接服务器，比Xshell好用多了

访问[3X-UI官方仓库](https://github.com/MHSanaei/3x-ui?tab=readme-ov-file)，按照README说明，通过以下命令一键安装：

```bash
bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)
```

安装时根据提示设置你的面板端口和登录密码。

### 2.3.1 配置Shadowsocks（SS）节点

安装完成后，通过浏览器访问以下地址进入面板（替换为你的IP和设置的端口）：

```bash
http://你的服务器IP:端口
例如：http://103.123.123.123:7890
```

输入面板登录账号和密码进入后台

![图 0](../images/99643802305e8c97b9b2785cf9054980674201e83c8a218b97d147056228df92.png)  

在后台进行如下配置：

1. 点击`入站列表` → `添加入站`
2. 按以下配置进行填写：
   - **协议**：选择`Shadowsocks`
   - **端口**：自定义（随意填写）
   - **加密方式**：建议使用`AES_256_GCM`（兼容性更好）
   - **Sniffing**：建议开启

完成上述步骤后点击添加即可成功创建一个SS节点。
![1](../images/c7974686a11f66c1d6983342808dfb09813bbfcdf5f279dd1b157bc536242a92.png)  


### 2.3.2 配置vmess+ws节点

在后台进行如下配置：

1. 点击`入站列表` → `添加入站`
2. 按以下配置进行填写：
   - **协议**：选择`vmess`
   - **端口**：自定义（随意填写）
   - **传输**：WebSocket
   - **路径**：把客户ID的前一段复制到路径中，如图
   - **Sniffing**：建议开启

![图 2](../images/5ebb32e6416df53c302726e6861e50768d5b4740dba9ccbffc8ec30df1f46b65.png)  



### 2.4 添加节点到v2rayN

完成节点创建后，点击`导出链接`。

在你的v2rayN客户端上，鼠标右键选择`从剪贴板导入批量URL`，即可快速添加节点。

添加成功后，右键节点并点击`测试服务器速度`进行检测，有速度则说明可用，此时点击`自动配置代理`后，应该就可以访问谷歌，随后我们将解决你在使用中会发现的问题

## 3. 为什么自己搭建的节点速度那么慢和不稳定

**一般要从线路、网络拥塞策略、协议、服务器地理位置 来分别讨论**

### 3.1 什么是CN2 GIA

**在这里我们将引入线路的概念**

#### 3.1.1你的电脑是如何访问到谷歌的

1. **局域网到路由器**：你的电脑先把数据包发送到路由器（网关）。
2. **NAT转换**：路由器对数据包做NAT转换，将私有IP替换为公网IP。
3. **接入城域网**：经过光纤把数据包传输到本地机房或汇聚节点，再进入城域网。
4. **接入省级或运营商骨干网**：数据包被引流到省级骨干网络或IDC机房（不同运营商不同）。
5. **出海**：在骨干网中继续跳转，抵达国际出口（海底光缆/跨境线路，或者更贵的专线），然后出海。
6. **海外骨干网**：在海外的骨干网络里继续路由，最终跳转到Google服务器。
7. **回程**：Google服务器返回数据时，通常沿着同一条或相似的线路返回，最终到达你的局域网。


我明白这种抽象的语言有点难以理解，所以在下面模拟一个数据包的跳转流程，可以对照看

```
# 1. 局域网第一跳
源IP: 192.168.1.100
目标IP: 192.168.1.1 （默认网关 / 家用路由器）

# 2. NAT转换后出发
源IP: 123.45.67.89 （公网IP）
目标IP: 10.1.1.1 （本地ISP边缘网关）

# 3. 进入城域网核心节点
源IP: 123.45.67.89
目标IP: 172.16.0.1 （市级ISP核心路由器）

# 4. 上升至省级骨干网络
源IP: 123.45.67.89
目标IP: 203.0.113.1 （省级IDC或骨干汇聚设备）

# 5. 接入国际出口，准备出海
源IP: 123.45.67.89
目标IP: 198.51.100.1 （国际出口路由器，下一步就是走海底光纤出国）

# 6. 跨境跳转至海外骨干网
源IP: 123.45.67.89
目标IP: 8.8.8.8 （国外的骨干网）

# 7. 跳转至最终目标服务器
源IP: 123.45.67.89
目标IP: 142.250.190.78 （Google主站某个Web服务IP）

# 8. Google服务器响应数据，数据回程（可能略有不同）
源IP: 142.250.190.78
目标IP: 123.45.67.89 -> NAT还原 -> 192.168.1.100

# 最终：你在浏览器中看到 Google 页面
访问地址: https://www.google.com
```

#### 3.1.2 什么是线路，什么是CN2 GIA

我们所要讨论的线路就是**骨干网络**

国内从 市 --> 省 --> 国际出口 这一段都是骨干网

因为笔者家里网络是电信的，所以我们以电信的网络为例来进行讨论

很久之前中国电信搭建了地下光纤、海底光纤，组成了最早的网络，叫`163骨干网`，这张网络不止是国内访问，还包括出海，由于用的人实在太多了，再加上海底光纤数量有限，就导致一到高峰期，出海网络就会丢包、高延迟、卡顿

如此，第二代网络应运而生，CN2，ChinaNet Next Carrier Network（ChinaNet 下一代承载网络），相较于163骨干网，延迟更低，更贵，但也更稳定。

电信把CN2分为两半，海内和海外，在海外走CN2、在海内走163骨干网的称之为CN2 GT ，在海内海外都走CN2 称之为CN2 GIA ，因此GIA线路往往卖的更贵

由于想卖的更贵，电信又把CN2分成了三种：

1. **单网 CN2 GIA**： 仅中国电信用户访问去回，走 CN2 GIA 网络，联通/移动/教育网等用户访问过去，均走各自运营商的国际出口。
2. **双网 CN2 GIA**： 中国电信/中国联通用户访问过去，走 CN2 GIA 网络
3. **三网 CN2 GIA**： 中国电信/中国联通/中国移动三网用户的去回访问，均会在省级并入到 CN2 网络 （如搬瓦工的DC9机房）

线路是在你选购VPS的时候就确定了，因此这应该是在选购VPS时考虑的因素

#### 3.1.3 移动联通高端线路

这里有读者要问了，主播主播，我家不是电信的，移动联通有没有和CN2一样的新线路呢

有的兄弟，有的


联通的骨干网络：169网络(AS4837)
联通的高端网络：A网（AS9929）但用的是老技术，所以效果并不好

移动的骨干网络：AS9808 
移动的高端网络：CMI

高端线路对标CN2 骨干网络对标163

#### 3.1.4 怎么判断是不是精品线路

在VPS上执行以下脚本即可
`curl https://raw.githubusercontent.com/zhucaidan/mtr_trace/main/mtr_trace.sh|bash  # 检测回程脚本`

### 3.2 网络拥塞策略

#### 3.2.1 概述

为了保证 TCP 连接的稳定性并尽量减少丢包，TCP 协议引入了网络拥塞控制策略。传统的拥塞控制算法通常遵循`探测带宽`的模式，在不丢包的情况下逐步增加发送频率，一旦丢包则会大幅降低发送频率，随后再慢慢增加，这显然会导致网速的不稳定

为了解决这个问题，Google 提出了 BBR拥塞控制算法。BBR 并不是依赖丢包来判断网络状态，而是通过实时估算带宽上限和最小（往返时延）来调整发送速率，从而更好的维持网络稳定

因此我们一般都会通过修改网络拥塞策略来得到更稳定的网速，而我们会觉得BBR不够激进，因此会使用魔改后的BBR（BBRPlus），同样可以通过一键脚本安装

#### 3.2.2 安装BBRPlus

在VPS中执行以下内容，加速脚本四合一，如果缺少的工具如curl、wget自行安装
`wget -N --no-check-certificate "https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh" && chmod +x tcp.sh && ./tcp.sh
`

需要先安装BBRplus内核再启动BBRplus，期间会申请卸载原本的内核，需要点同意，否则会安装不上

#### 3.2.3 其他方法

有一个协议，是基于UDP协议优化的，专门用来加速VPS速度的，而且效果十分夸张，叫[hysteria](https://github.com/apernet/hysteria)

缺点是很多代理软件都不支持这个协议，用了这个协议基本手机是没办法用代理了，因此在这里不推荐，可以等发展

### 3.3 协议对网速的影响

根据笔者的实测，ss协议延迟最低，速度最快，vmess+ws的延迟包括reality协议的延迟会高很多，但我们依然脱不开这些协议，为了流量更不容易被检测要选择这些延迟更高的协议，但每个地区的限制策略不同，有些地方用vmess+ws更容易被封，用ss反而不容易被封，这些都需要自己去测试。

## 4. 为什么节点会连不上


### 4.1 概述

当节点测速失败并且测试cping失败，基本可以确定是vps或者这个端口被墙了，原因是GFW（中国的防火墙）会检测敏感流量，当他认为你这是代理流量时会把发往这个端口的流量屏蔽掉，就导致端口被封禁，这就是为什么很多协议明明延迟很高，但很多人用的原因

### 4.2 怎么判断端口是否被封禁

使用这个网站去查看，如果这个端口在国外可以正常访问，而在国内无法访问，则是被封禁

`https://tcp.ping.pe/`

### 4.3 如何解决

#### 4.3.1 换协议

不停的换协议和端口，直到发现某个协议在你所处的地区风控不严，截至2025.4 reality协议依旧是一个好选择

#### 4.3.2 使用专线中专

有商家可以从运营商手上拿到出海线路的使用权，而这些商家把线路拿出来卖，会给你一个IP和端口，在连接你的VPS之前，通过这个专线出海，再连接到你的VPS，可以保证在国内到出海口这段路径速度不慢，并且不用过GFW，所以使用ss协议就可以稳定（举个栗子：商家拿到上海-->日本的线路，商家得到就是一根光纤，一头在上海，一头在日本，从你家到上海，这是国内线路，不会风控，直接走他的光纤出国，出国直接接入国外骨干网，直接绕过GFW了，所以哪怕用再不安全的协议都能访问到）

使用教程等我下次买的时候配截图一起写


#### 4.3.3 如何套一层cloudflare的CDN

什么是CDN：是由一些企业免费或付费提供，目的是加速网页的访问速度，而为了套一层CDN，你需要准备一个自己的域名，由于时效性的问题需要读者自行搜索注册教程，或者花点钱组一个域名

1. **将注册好的域名填写进去，点击继续**

![图 9](../images/a02227e6e7c4d8742f38c2b1fa3d5815231775f68d96d284faf19b0e8a026579.png)  

2. **选择免费套餐**
![图 13](../images/6e07ccd41023374d4df7bca335c557cc832857163a0902a07429061899cc31ad.png)  


3. **选择添加记录**
![图 10](../images/47389b28132f239e5852c00a1ac2e00c3ad8070a4f23b83f5f0eaf5823b75794.png)  

1. **添加前缀和你的服务器IP**
![图 11](../images/32cf1134085033e6079a12d52776d24f1c653c2940aa2367e440c7f02d037df6.png)  

1. **他会给你提供两个NS服务器**
![图 7](../images/407b741b9fa478858341460245dad19ca3cda4c431accc904363c14026b681f7.png)  

1. **将这两个ns服务器添加到你注册的域名中**
![图 12](../images/1f0048b248a7adea92a9017523eff6f8471adf38d652489eb39870f716b5af87.png)

1. **等待一段时间DNS生效，在主机ping域名就可以看到自己服务器的ip了**

2. **在v2rayN中修改服务器地址，把服务器地址改成自己申请的域名，则成功套上一层CDN**

有了这个域名，无论是套CDN还是使用reality协议都有了基础，也就更不容易被封了，到这里的技术已经够节点稳定使用了

## 5. 为什么自己的节点建账号总是被风控

### 5.1 引入

在这里我们将引入`IP纯净度`的概念

你的在VPS商家买的VPS所分配的IP基本都会被检测为风险IP，因为每个商家的IP所拥有的IP段基本都是确定的，在这个IP段内的IP都会被增加检测，一旦检测到是被用来做代理转发，就会被添加到黑名单

这就导致了被加入了黑名单的IP使用chatgpt会被降智，Claude账号被封，无法打开paypal，无法运营tiktok账号，无法使用Google Voice，Google Driver无法购买套餐

其二，由于VPS商家的IP会被检测为机房IP而非住宅IP，因此很多服务也无法使用，比如说网飞的非自制剧,包括上述所说的gpt和claude

以下方法可以检测IP纯净度

```
网站1: `https://scamalytics.com/ip` 一般40分以上我就认为是风险IP

在VPS执行如下脚本，可以查看有哪些服务没有解锁：`curl -L https://gitlab.com/spiritysdx/za/-/raw/main/ecs.sh -o ecs.sh && chmod +x ecs.sh && bash ecs.sh`
```

### 5.2 如何解决

既然说了，是IP有风险的问题，那么就购买一个住宅IP，作为访问这些网站的跳板，在圈内被称之为落地鸡，没有免费的

一般的住宅IP购买网站会提供如下套餐：

1. **socket5代理**：一般200个ip起卖，一个IP大约0.148美元，每个ip激活后可用1小时
2. **无限住宅代理**： 按天购买，一天时间内无论用多少个IP，每个IP用多久都没有限制，一般一天300美元
3. **住宅代理套餐**： 按照流量计费，2美元/G
4. **静态住宅代理**： 相当于买一个固定的住宅IP，一个IP一年20美元

笔者这里购买的是静态住宅代理，购买后，商家会提供一个IP，端口，socket账号和密码

#### 如何使用

1. 打开你的 3x-ui 控制面板
2. 进入 `xray设置 -> 出站规则`，点击“添加出站”
3. 协议选择 `socks`，标签随意（比如：residential-ip）
4. 将商家提供的 IP地址、端口、用户名、密码 分别填入
5. 点击“确定”，然后重启 xray

接下来：
1. 进入 `路由规则` 页面，点击“添加规则”
2. 将 `inbound Tag` 设置为你当前使用的入站节点
3. `outbound Tag` 选择刚刚设置的那个住宅IP出站
4. 保存并重启 `xray`
现在你的手机和电脑，只要使用这个节点，就可以使用你购买的静态住宅IP了

**如何判断是否成功？**

可以在[ipinfo](https://ipinfo.io/)查看自己的IP是否变成了购买的ip来进行判断

## 结尾

至此，我觉得在搭建节点方向已经没有更多需要了解的了，over

## 参考文献